<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† –û–±—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º CSS —Ñ–∞–π–ª—ã -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/training.css') }}">
</head>
<body>
    <div class="header">
        <h1>üß† –û–±—É—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ö–ª–µ–±–∞</h1>
        <a href="/" style="color: #cbd5e0; text-decoration: none;">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>

    <div class="container">
        <div class="main-grid">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ -->
            <div class="panel">
                <h3>üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏</h3>

                <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
                <div class="upload-area" id="uploadArea">
                    <p>üì§ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∏–¥–µ–æ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <input type="file" id="fileInput" accept="video/*" style="display: none;">
                </div>

                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
                <div class="progress-container" id="progressContainer">
                    <div class="progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                    <div class="progress-text" id="progressDetails"></div>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ -->
                <div class="file-list" id="fileList"></div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFiles">0</div>
                        <div class="stat-label">–§–∞–π–ª–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalSize">0</div>
                        <div class="stat-label">GB</div>
                    </div>
                </div>
            </div>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å - –≤–∏–¥–µ–æ -->
            <div class="panel">
                <div id="videoPanel" class="video-panel">
                    <h3>üé¨ –†–∞–±–æ—Ç–∞ —Å –≤–∏–¥–µ–æ</h3>

                    <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã –≤–∏–¥–µ–æ -->
                    <div class="video-controls">
                        <button class="btn btn-secondary" onclick="previousFrame()">‚èÆÔ∏è</button>
                        <input type="range" id="frameSlider" class="frame-slider" min="0" max="100" value="0">
                        <button class="btn btn-secondary" onclick="nextFrame()">‚è≠Ô∏è</button>
                        <span id="frameInfo">0 / 0</span>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–º–µ—Ä–µ -->
                    <div id="cameraInfo" class="camera-info" style="display: none;">
                        <strong>üìπ –ö–∞–º–µ—Ä–∞:</strong> <span id="cameraName">–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</span> 
                        <span style="color: #718096;">(<span id="cameraId">unknown</span>)</span>
                    </div>

                    <!-- –ó–æ–Ω—ã -->
                    <div class="zone-controls">
                        <div class="zone-header">üéØ –†–∞–∑–º–µ—Ç–∫–∞ –∑–æ–Ω –¥–µ—Ç–µ–∫—Ü–∏–∏</div>

                        <!-- –®–∞–±–ª–æ–Ω—ã –∑–æ–Ω -->
                        <div class="zone-templates">
                            <div class="templates-label">üìã –®–∞–±–ª–æ–Ω—ã –∑–æ–Ω:</div>
                            <button class="btn btn-sm btn-secondary" onclick="loadZoneTemplate('standard_oven')">üè≠ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–µ—á—å</button>
                            <button class="btn btn-sm btn-secondary" onclick="loadZoneTemplate('conveyor_oven')">üèóÔ∏è –ö–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è</button>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–æ–Ω -->
                        <div class="zone-buttons">
                            <button class="zone-btn entry" onclick="setZoneMode('entry')">üü¢ –í—Ö–æ–¥</button>
                            <button class="zone-btn counting" onclick="setZoneMode('counting')">üü° –ü–æ–¥—Å—á–µ—Ç</button>
                            <button class="zone-btn exit" onclick="setZoneMode('exit')">üî¥ –í—ã—Ö–æ–¥</button>
                            <button class="zone-btn gray" onclick="setZoneMode('gray')">‚ö´ –°–µ—Ä–∞—è</button>
                        </div>

                        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–æ–Ω–∞–º–∏ -->
                        <div class="zone-actions">
                            <button class="btn btn-primary" onclick="saveZones()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–æ–Ω—ã</button>
                            <button class="btn btn-primary" onclick="detectObjects()">üîç –ù–∞–π—Ç–∏ –æ–±—ä–µ–∫—Ç—ã</button>
                            <button class="btn btn-danger" onclick="clearZones()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>

                    <!-- Canvas –¥–ª—è –≤–∏–¥–µ–æ -->
                    <div class="canvas-container">
                        <canvas id="videoCanvas"></canvas>
                        <canvas id="overlayCanvas" class="canvas-overlay"></canvas>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –æ–±—ä–µ–∫—Ç—ã –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ -->
            <div class="panel">
                <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ -->
                <div class="mode-toggle">
                    <button class="btn btn-primary" id="modeToggleBtn" onclick="toggleTrainingMode()">
                        üè≠ –ü–∞–∫–µ—Ç–Ω—ã–π —Ä–µ–∂–∏–º
                    </button>
                </div>

                <!-- –û–±—ã—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã -->
                <div id="regularObjectsSection">
                    <h3>üìã –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã</h3>
                    <div id="objectsList" class="object-list"></div>

                    <!-- –§–æ—Ä–º–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ -->
                    <div id="annotationForm" class="annotation-form" style="display: none;">
                        <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞</h3>
                        <div class="form-group">
                            <label>GUID:</label>
                            <input type="text" id="productGuid" readonly>
                        </div>
                        <div class="form-group">
                            <label>–ö–æ–¥ SKU:</label>
                            <input type="text" id="productSku" placeholder="–í–≤–µ–¥–∏—Ç–µ SKU">
                        </div>
                        <div class="form-group">
                            <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ:</label>
                            <input type="text" id="productName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞">
                        </div>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="productCategory">
                                <option value="bread">–•–ª–µ–±</option>
                                <option value="bun">–ë—É–ª–æ—á–∫–∏</option>
                                <option value="loaf">–ë–∞—Ç–æ–Ω</option>
                                <option value="pastry">–í—ã–ø–µ—á–∫–∞</option>
                            </select>
                        </div>
                        <button class="btn btn-success" onclick="saveAnnotation()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary" onclick="cancelAnnotation()">‚ùå –û—Ç–º–µ–Ω–∞</button>
                    </div>

                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è -->
                    <div class="training-stats">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value" id="annotatedCount">0</div>
                                <div class="stat-label">–ê–Ω–Ω–æ—Ç–∞—Ü–∏–π</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="zonesCount">0</div>
                                <div class="stat-label">–ó–æ–Ω</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ü–∞–∫–µ—Ç–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ -->
                <div id="batchTrainingPanel" style="display: none;">
                    <h3>üè≠ –ü–∞–∫–µ—Ç–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ</h3>
                    
                    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ -->
                    <div id="batchCreationForm" class="batch-section">
                        <h4>üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏</h4>
                        <div class="form-group">
                            <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞:</label>
                            <input type="text" id="batchProductName" placeholder="–•–ª–µ–± –±–µ–ª—ã–π —Ñ–æ—Ä–º–æ–≤–æ–π">
                        </div>
                        <div class="form-group">
                            <label>SKU –∫–æ–¥:</label>
                            <input type="text" id="batchSku" placeholder="BREAD_001">
                        </div>
                        <div class="form-group">
                            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                            <select id="batchCategory">
                                <option value="bread">–•–ª–µ–±</option>
                                <option value="bun">–ë—É–ª–æ—á–∫–∏</option>
                                <option value="loaf">–ë–∞—Ç–æ–Ω</option>
                                <option value="pastry">–í—ã–ø–µ—á–∫–∞</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>–û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                            <input type="number" id="batchSize" value="1500" min="100" max="5000">
                        </div>
                        <div class="form-group">
                            <label>–û–ø–µ—Ä–∞—Ç–æ—Ä:</label>
                            <input type="text" id="batchOperator" placeholder="–ò–≤–∞–Ω–æ–≤ –ò.–ò.">
                        </div>
                        <button class="btn btn-success" onclick="createBatch()">üÜï –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—Ç–∏—é</button>
                    </div>
                    
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –ø–∞—Ä—Ç–∏–∏ -->
                    <div id="currentBatchInfo" class="batch-section" style="display: none;">
                        <h4>üìä –¢–µ–∫—É—â–∞—è –ø–∞—Ä—Ç–∏—è</h4>
                        <div class="batch-info-grid">
                            <div class="info-item">
                                <strong>ID:</strong> <span id="batchId">-</span>
                            </div>
                            <div class="info-item">
                                <strong>–ü—Ä–æ–¥—É–∫—Ç:</strong> <span id="batchProduct">-</span>
                            </div>
                            <div class="info-item">
                                <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="batchStatus" class="status-badge">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Ç–∞–ª–æ–Ω–∞ -->
                    <div id="templateSection" class="batch-section" style="display: none;">
                        <h4>üéØ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç—Ç–∞–ª–æ–Ω–∞</h4>
                        <p class="template-description">
                            –í—ã–±–µ—Ä–∏—Ç–µ 2-3 —Ö–æ—Ä–æ—à–∏—Ö –æ–±—ä–µ–∫—Ç–∞ –∫–∞–∫ —ç—Ç–∞–ª–æ–Ω –¥–ª—è –ø–∞—Ä—Ç–∏–∏
                        </p>
                        <div id="selectedTemplateObjects" class="template-objects-list"></div>
                        <div class="template-actions">
                            <button class="btn btn-primary" onclick="setTemplate()">‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–∞–ª–æ–Ω</button>
                            <button class="btn btn-secondary" onclick="clearTemplate()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </div>
                    
                    <!-- –ê–≤—Ç–æ–æ–±—É—á–µ–Ω–∏–µ -->
                    <div id="autoTrainingSection" class="batch-section" style="display: none;">
                        <h4>ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ</h4>
                        
                        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
                        <div class="settings-row">
                            <label>–ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏:</label>
                            <input type="range" id="similarityThreshold" min="0.5" max="1.0" step="0.05" value="0.8">
                            <span id="thresholdValue">0.8</span>
                        </div>
                        
                        <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã -->
                        <div class="training-controls">
                            <button class="btn btn-success" id="startAutoBtn" onclick="startAutoTraining()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button class="btn btn-danger" id="stopAutoBtn" onclick="stopAutoTraining()" style="display: none;">‚èπÔ∏è –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
                            <button class="btn btn-warning" onclick="processCurrentFrame()">üîÑ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–¥—Ä</button>
                        </div>
                        
                        <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å -->
                        <div id="trainingProgress" class="training-progress" style="display: none;">
                            <div class="progress-item">
                                <span>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:</span>
                                <span id="processedCount">0</span>
                            </div>
                            <div class="progress-item good">
                                <span>–•–æ—Ä–æ—à–∏—Ö:</span>
                                <span id="goodCount">0</span>
                            </div>
                            <div class="progress-item defect">
                                <span>–ë—Ä–∞–∫:</span>
                                <span id="defectCount">0</span>
                            </div>
                            <div class="progress-item anomaly">
                                <span>–ê–Ω–æ–º–∞–ª–∏–∏:</span>
                                <span id="anomalyCount">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –û—á–µ—Ä–µ–¥—å –∞–Ω–æ–º–∞–ª–∏–π -->
                    <div id="anomalyQueueSection" class="batch-section" style="display: none;">
                        <h4>‚ö†Ô∏è –ê–Ω–æ–º–∞–ª–∏–∏ (<span id="anomalyQueueCount">0</span>)</h4>
                        <div id="anomalyQueue" class="anomaly-queue"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º JavaScript —Ñ–∞–π–ª—ã -->
    <script src="{{ url_for('static', filename='js/training.js') }}"></script>
    <script src="{{ url_for('static', filename='js/batch_training.js') }}"></script>
</body>
</html>